<p id="notice"><%= notice %></p>

<h1>Listing Measurements</h1>

<table>
  <thead>
    <tr>
      <th>Val</th>
      <th>Name</th>
      <th>Position</th>
      <th>Ts</th>
      <th>Inserted</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @measurements.each do |measurement| %>
      <tr>
        <td><%= measurement.val %></td>
        <td><%= measurement.name %></td>
        <td><%= measurement.position %></td>
        <td><%= measurement.ts %></td>
        <td><%= measurement.inserted %></td>
        <td><%= link_to 'Show', measurement %></td>
        <td><%= link_to 'Edit', edit_measurement_path(measurement) %></td>
        <td><%= link_to 'Destroy', measurement, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Measurement', new_measurement_path %>

<!-- create a placeholder for the flot graph -->
<h2>Kuhmo, Kalliojoki</h2>
<div id="flot-placeholder" style="width:600px; height: 400px"></div>

<script type="text/javascript">
$(function() {
    var flotdata = [];
    var options = {
                xaxis: {
                    mode: "time"
                }
            };

    function onDataReceived(data) {
        for (i = 0; i < data.length; i++) {
            flotdata.push([new Date(data[i]['ts']).getTime(), 1.0 * data[i]['val']]);
        }

        console.log(flotdata);

        $.plot("#flot-placeholder", [{label: 'Keskilämpötila', data: flotdata}], options);
    }
    $.ajax({
        url: '/measurements.json?n=tday&starttime=2015-01-01',
        type: 'GET',
        dataType: 'json',
        success: onDataReceived
    });
});
</script>